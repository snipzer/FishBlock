<?php

namespace MainBundle\Repository;

/**
 * EpisodeRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class EpisodeRepository extends \Doctrine\ORM\EntityRepository
{
    public function getEpisodes()
    {
        return $this->findAll();
    }

    public function getEpisodesFromSerie($serieId)
    {
        $serieRepository = $this->getEntityManager()->getRepository("MainBundle:Serie");
        $serie = $serieRepository->getSerieWithId($serieId);

        return $this->getEntityManager()->createQuery(
            'SELECT e
              FROM MainBundle\Entity\Episode e
              JOIN MainBundle\entity\Serie s
              WHERE e.serie = :serie
              ORDER BY e.episodeNumber ASC, e.seasonNumber ASC'
        )->setParameter('serie', $serie)->getResult();
    }

    // Renvois le dernier Ã©pisode d'une sÃ©rie choisie avec l'uuid
    public function getLastEpisodeFromSerie($serieId)
    {
        $serieRepository = $this->getEntityManager()->getRepository("MainBundle:Serie");
        $serie = $serieRepository->getSerieWithId($serieId);

        return $this->getEntityManager()->createQuery(
            'SELECT e
              FROM MainBundle\Entity\Episode e
              JOIN MainBundle\entity\Serie s
              WHERE e.serie = :serie
              ORDER BY e.episodeNumber DESC'
        )->setParameter('serie', $serie)->setMaxResults(1)->getResult();
    }

    public function CheckIfEpisodeAlreadyHere($episodeName, $episodeNumber, $seasonNumber)
    {
        if($this->findBy([
            "title" => $episodeName,
            "episodeNumber" => $episodeNumber,
            "seasonNumber" => $seasonNumber
        ]))
        {
            return true;
        }
        return false;
    }
}
